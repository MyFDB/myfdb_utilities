#!/usr/bin/env ruby

lib = File.expand_path(File.dirname(__FILE__) + '/../lib')
$LOAD_PATH.unshift(lib) if File.directory?(lib) && !$LOAD_PATH.include?(lib)

require 'myfdb'
require 'version'
require 'commander/import'
require 'command/helpers'

include Command::Helpers

program :version, Myfdb::VERSION
program :description, 'Misc tasks related to myfdb.com'

command :process_magazines do |c|
  c.syntax = 'myfdb process_magazines [options]'
  c.description = 'Porcesses magazines by creates issues and uploading tear_sheet images'

  c.option '--host HOSTNAME', 'Hostname of the server'
  c.option '-d', '--base_directory PATH_TO_FOLDER', 'Default HOME'
  c.option '-u', '--username USERNAME', 'Basic authentication username'
  c.option '-p', '--password PASSWORD', 'Basic authentication password'

  c.action do |args, options|

    parse_options(options)
    options.default \
      :directory => set_directory(options.host),
      :username => ENV['MYFDB_PROCESS_MAG_USERNAME'],
      :password => ENV['MYFDB_PROCESS_MAG_PASSWORD']

    create_directory?(options.directory)

    Myfdb::Magazines.process(options) if process_not_running?(options.host)
  end
end


